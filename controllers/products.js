
const Product = require('../models/product');

module.exports = { 

    index: async (req, res) => {
        if (!req.isAuthenticated()) {
            res.redirect('/auth/login');
        }
        let { term, statusParam } = req.query;
        term = term.toLowerCase();
        const products = await Product.find({$and: [{$text: {$search: term}}, {"Status": statusParam}]}).lean()
        res.render('search-by-items', {products, term, statusParam});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    },
    
    product: async (req, res) => {
        if (!req.isAuthenticated()) {
            res.redirect('/auth/login');
        }  
        let { id } = req.query;
        const product = await Product.findById(number).lean()
        res.render('product-card', {product})
    }
};
